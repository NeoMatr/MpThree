<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="theme-color" content="#08080c">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>MpThree</title>
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Outfit:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Styles -->
  <link rel="stylesheet" href="styles.css">
  
  <!-- PWA -->
          <link rel="manifest" href="manifest.webmanifest">
          <link rel="icon" type="image/svg+xml" href="icon.svg">
          <link rel="apple-touch-icon" href="icon-192.png">
</head>
<body>
  <div class="app-container">
    <!-- Navigation -->
    <nav class="nav-bar">
      <div class="nav-content">
        <a href="#" class="nav-logo" id="logoLink">
          <span id="logoIcon"></span>
          <span>MpThree</span>
        </a>
        <div class="nav-links" id="navLinks">
          <button class="nav-link active" data-view="library">
            <span id="navLibraryIcon"></span>
            <span>Library</span>
          </button>
          <button class="nav-link" data-view="now-playing">
            <span id="navNowPlayingIcon"></span>
            <span>Now Playing</span>
          </button>
          <button class="nav-link" data-view="playlists">
            <span id="navPlaylistsIcon"></span>
            <span>Playlists</span>
          </button>
        </div>
        <button class="nav-toggle" id="navToggle" aria-label="Toggle menu">
          <span id="menuIcon"></span>
        </button>
      </div>
    </nav>

    <!-- ==================== LIBRARY VIEW ==================== -->
    <main class="main-content view" id="libraryView">
      <div class="page-header">
        <h1>
          <span id="libraryIcon"></span>
          Library
        </h1>
        <div class="page-actions">
          <button class="btn btn-primary" id="importBtn">
            <span id="uploadIcon"></span>
            Import Music
          </button>
        </div>
      </div>
      
      <input type="file" id="fileInput" accept=".mp3,audio/mpeg" multiple hidden>
      <input type="file" id="artworkInput" accept="image/*" hidden>
      
      <!-- Search -->
      <div class="mb-6">
        <input type="text" class="input search-input" id="searchInput" placeholder="Search your library...">
      </div>
      
      <!-- Track List -->
      <div id="trackList">
        <div class="empty-state" id="libraryEmptyState">
          <span id="emptyMusicIcon"></span>
          <h2>Your library is empty</h2>
          <p>Click "Import Music" above to add MP3 files</p>
        </div>
      </div>
    </main>

    <!-- ==================== NOW PLAYING VIEW ==================== -->
    <main class="main-content view" id="nowPlayingView" style="display: none;">
      <div class="now-playing-container" id="nowPlayingContainer">
        <!-- Empty state when nothing is playing -->
        <div class="empty-state" id="npEmptyState">
          <span id="emptyPlayIcon"></span>
          <h2>Nothing playing</h2>
          <p>Select a track from your library to start listening</p>
          <button class="btn btn-primary" id="goToLibraryBtn">
            Go to Library
          </button>
        </div>
        
        <!-- Now playing content (hidden by default) -->
        <div id="nowPlayingContent" style="display: none; width: 100%; max-width: 500px;">
          <div class="now-playing-art" id="nowPlayingArt">
            <div class="now-playing-art-placeholder" id="artPlaceholder"></div>
          </div>
          
          <div class="now-playing-info">
            <h1 class="now-playing-title" id="nowPlayingTitle">—</h1>
            <p class="now-playing-artist" id="nowPlayingArtist">—</p>
          </div>
          
          <div class="now-playing-progress">
            <div class="progress-bar" id="progressBar">
              <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            <div class="now-playing-times">
              <span id="currentTime">0:00</span>
              <span id="duration">0:00</span>
            </div>
          </div>
          
          <div class="now-playing-controls">
            <button class="btn btn-ghost btn-icon" id="shuffleBtn" aria-label="Shuffle">
              <span id="shuffleIcon"></span>
            </button>
            <button class="btn btn-ghost btn-icon" id="prevBtn" aria-label="Previous">
              <span id="skipBackIcon"></span>
            </button>
            <button class="btn btn-accent btn-icon lg" id="playPauseBtn" aria-label="Play">
              <span id="playPauseIcon"></span>
            </button>
            <button class="btn btn-ghost btn-icon" id="nextBtn" aria-label="Next">
              <span id="skipForwardIcon"></span>
            </button>
            <button class="btn btn-ghost btn-icon" id="repeatBtn" aria-label="Repeat">
              <span id="repeatIcon"></span>
            </button>
          </div>
          
          <div class="now-playing-secondary-controls">
            <div class="volume-control" style="flex: 1;">
              <button class="btn btn-ghost btn-icon sm" id="volumeBtn" aria-label="Volume">
                <span id="volumeIcon"></span>
              </button>
              <div class="volume-slider" id="volumeSlider" style="flex: 1;">
                <div class="volume-fill" id="volumeFill" style="width: 100%"></div>
              </div>
            </div>
            <button class="btn btn-ghost btn-icon sm" id="queueBtn" aria-label="Queue">
              <span id="queueIcon"></span>
            </button>
          </div>
        </div>
      </div>
      
      <!-- Queue Panel -->
      <div id="queuePanel" class="card" style="display: none; margin-top: 24px;">
        <div class="card-body">
          <div class="flex items-center justify-between mb-4">
            <h3>Queue</h3>
            <button class="btn btn-ghost btn-icon sm" id="closeQueueBtn" aria-label="Close queue">
              <span id="closeQueueIcon"></span>
            </button>
          </div>
          <div class="track-list" id="queueList"></div>
        </div>
      </div>
    </main>

    <!-- ==================== PLAYLISTS VIEW ==================== -->
    <main class="main-content view" id="playlistsView" style="display: none;">
      <div class="page-header" id="playlistsHeader">
        <h1>
          <span id="playlistsIcon"></span>
          Playlists
        </h1>
        <div class="page-actions">
          <button class="btn btn-primary" id="createPlaylistBtn">
            <span id="plusIcon"></span>
            New Playlist
          </button>
        </div>
      </div>
      
      <!-- Playlists Grid -->
      <div id="playlistsGrid" class="playlist-grid"></div>
      
      <!-- Empty State -->
      <div class="empty-state" id="playlistsEmptyState" style="display: none;">
        <span id="emptyPlaylistIcon"></span>
        <h2>No playlists yet</h2>
        <p>Click "New Playlist" above to create one</p>
      </div>
      
      <!-- Playlist Detail View (hidden by default) -->
      <div id="playlistDetail" style="display: none;">
        <div class="page-header">
          <h1>
            <button class="btn btn-ghost btn-icon" id="backBtn" aria-label="Back" style="margin-right: 8px;">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="24" height="24">
                <path d="m15 18-6-6 6-6"/>
              </svg>
            </button>
            <span id="playlistDetailTitle">Playlist Name</span>
          </h1>
          <div class="page-actions">
            <button class="btn btn-accent btn-icon" id="playPlaylistBtn" aria-label="Play">
              <span id="playPlaylistIcon"></span>
            </button>
            <button class="btn btn-secondary btn-icon" id="editPlaylistBtn" aria-label="Edit">
              <span id="editPlaylistIcon"></span>
            </button>
            <button class="btn btn-ghost btn-icon" id="deletePlaylistBtn" aria-label="Delete">
              <span id="deletePlaylistIcon"></span>
            </button>
          </div>
        </div>
        
        <!-- Playlist Art + Info -->
        <div class="playlist-detail-art-container mb-6">
          <div class="playlist-detail-art" id="playlistDetailArt">
            <div class="playlist-art-placeholder" id="playlistArtPlaceholder">
              <span id="playlistArtIcon"></span>
              <span class="playlist-art-hint">Add art</span>
            </div>
          </div>
          <input type="file" id="playlistArtInput" accept="image/*" hidden>
          <div class="playlist-detail-meta">
            <p class="text-secondary" id="playlistDetailCount">0 tracks</p>
          </div>
        </div>
        
        <div class="track-list" id="playlistTracks"></div>
        
        <div class="empty-state" id="playlistTracksEmptyState" style="display: none; padding: 24px;">
          <p class="text-secondary">Search above to add tracks</p>
        </div>
        
        <!-- Add Tracks Panel (always visible in playlist detail) -->
        <div id="addTracksPanel" class="card" style="margin-top: 24px;">
          <div class="card-body">
            <h3 class="mb-4">Add Tracks from Library</h3>
            <div class="mb-4">
              <input type="text" class="input search-input" id="addTracksSearch" placeholder="Search your library...">
            </div>
            <div class="track-list" id="addTracksList" style="max-height: 400px; overflow-y: auto;"></div>
          </div>
        </div>
      </div>
    </main>

    <!-- ==================== PLAYER BAR ==================== -->
    <div class="player-bar hidden" id="playerBar">
      <div class="player-bar-art" id="playerBarArt">
        <div class="now-playing-art-placeholder" id="playerBarArtPlaceholder"></div>
      </div>
      <div class="player-bar-info">
        <div class="player-bar-title" id="playerBarTitle">No track playing</div>
        <div class="player-bar-artist" id="playerBarArtist">—</div>
      </div>
      <div class="player-bar-controls">
        <button class="btn btn-ghost btn-icon sm" id="playerBarPrev" aria-label="Previous">
          <span id="playerBarPrevIcon"></span>
        </button>
        <button class="btn btn-accent btn-icon" id="playerBarPlayPause" aria-label="Play">
          <span id="playerBarPlayPauseIcon"></span>
        </button>
        <button class="btn btn-ghost btn-icon sm" id="playerBarNext" aria-label="Next">
          <span id="playerBarNextIcon"></span>
        </button>
      </div>
      <div class="player-bar-progress">
        <span class="player-bar-time" id="playerBarCurrentTime">0:00</span>
        <div class="progress-bar" id="playerBarProgress">
          <div class="progress-fill" id="playerBarProgressFill" style="width: 0%"></div>
        </div>
        <span class="player-bar-time" id="playerBarDuration">0:00</span>
      </div>
      <div class="volume-control">
        <button class="btn btn-ghost btn-icon sm" id="playerBarVolumeBtn" aria-label="Volume">
          <span id="playerBarVolumeIcon"></span>
        </button>
        <div class="volume-slider" id="playerBarVolumeSlider">
          <div class="volume-fill" id="playerBarVolumeFill" style="width: 100%"></div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Toast Container -->
  <div class="toast-container" id="toastContainer"></div>

          <!-- Scripts -->
          <script src="db.js"></script>
          <script src="metadata.js"></script>
          <script src="player.js"></script>
          <script src="media-session.js"></script>
          <script src="app.js"></script>
</body>
</html>
